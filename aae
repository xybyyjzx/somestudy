<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>代码调用链 - 树图（从上到下，点击展开）</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
    <style>
        body { margin: 0; padding: 20px; background: #f5f5f5; }
        #main { width: 800px; height: 600px; border: 1px solid #ccc; }
    </style>
</head>
<body>
    <h2>方法调用链 - 树图（垂直布局，点击展开）</h2>
    <p>从上到下展示逻辑：根A → 子B/C；点击B展开E/F/D。Hover 查看源码。</p>
    <div id="main"></div>
    <script type="text/javascript">
        var myChart = echarts.init(document.getElementById('main'));
        var option = {
            title: { text: '调用链树图示例', left: 'center' },
            tooltip: {
                formatter: function (params) {
                    if (params.data && params.data.source) {
                        return `
                            <strong>${params.name}</strong><br/>
                            <pre style="font-size:12px; margin:0;">${params.data.source}</pre>
                        `;
                    }
                    return params.name;
                }
            },
            series: [{
                type: 'tree',  // 树图类型
                orient: 'TB',  // TB: 从上到下 (Top to Bottom)；可选 'LR' 横向左到右
                roam: true,  // 支持缩放/拖拽
                data: [  // 树数据：children 数组表示子节点
                    {
                        name: '方法A (入口)\n入口点',
                        value: 'A',
                        source: 'def methodA():\n    # 处理用户输入\n    data = input()\n    methodB(data)\n    methodC(data)\n    return result',
                        itemStyle: { color: '#91cc75' },  // 绿色根节点
                        children: [  // 子节点
                            {
                                name: '方法B (处理数据)\ndata = process(input)',
                                value: 'B',
                                source: 'def methodB(data):\n    # 数据清洗\n    cleaned = data.strip()\n    sub_result = methodE(cleaned)\n    valid = methodF(sub_result)\n    result = methodD(cleaned)\n    return result',
                                children: [  // B的子节点（初始折叠）
                                    {
                                        name: '方法E (子任务)\nsub_process(data)',
                                        value: 'E',
                                        source: 'def methodE(cleaned):\n    # 子任务：过滤噪声\n    filtered = [x for x in cleaned if len(x) > 5]\n    return filtered',
                                        itemStyle: { color: '#fabbb9' }
                                    },
                                    {
                                        name: '方法F (子验证)\nsub_validate(result)',
                                        value: 'F',
                                        source: 'def methodF(sub_result):\n    # 子验证：检查完整性\n    if len(sub_result) == 0:\n        return False\n    return all(is_clean(x) for x in sub_result)',
                                        itemStyle: { color: '#a78bfa' }
                                    },
                                    {
                                        name: '方法D (输出)\noutput(result)',
                                        value: 'D',
                                        source: 'def methodD(cleaned):\n    # 输出到文件\n    with open("output.txt", "w") as f:\n        f.write(cleaned)\n    print("Done!")'
                                    }
                                ]
                            },
                            {
                                name: '方法C (验证)\nvalidate(input)',
                                value: 'C',
                                source: 'def methodC(data):\n    # 校验逻辑\n    if not is_valid(data):\n        raise ValueError("Invalid data")\n    return True'
                            }
                        ]
                    }
                ],
                initialTreeDepth: 1,  // 初始展开深度：1层（只显示A→B/C），点击展开更多
                label: {
                    position: 'left',
                    fontSize: 10,
                    formatter: '{b}'  // 显示name
                },
                leaves: {  // 叶子节点样式
                    label: { position: 'right' }
                },
                emphasis: {  // 点击/ hover 效果
                    focus: 'descendant'  // 高亮子树
                },
                lineStyle: {  // 连接线
                    width: 2,
                    color: '#ccc'
                }
            }]
        };
        myChart.setOption(option);
    </script>
</body>
</html>
